<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roblox Group Member Checker</title>

  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    body{background:linear-gradient(180deg,#071022 0%, #071428 60%);color:#e6eef8;
      margin:0;padding:30px;font-family:Inter,ui-sans-serif,system-ui}
    .wrap{max-width:900px;margin:auto}
    .card{background:var(--card);padding:20px;border-radius:14px;
      border:1px solid rgba(255,255,255,0.04);box-shadow:0 6px 30px rgba(0,0,0,0.5)}
    h1{margin:0;font-size:22px}
    p{color:var(--muted);margin:6px 0 22px}
    input{padding:10px;width:100%;border-radius:10px;border:1px solid rgba(255,255,255,0.05);
      background:var(--glass);color:white;margin-bottom:12px}
    button{padding:10px 16px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#5b21b6);
      color:white;font-weight:600;cursor:pointer;margin-right:8px}
    button.secondary{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.05)}
    table{width:100%;border-collapse:collapse;margin-top:20px}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.05);font-size:14px}
    th{color:var(--muted);font-size:12px}
    a{color:#8cc7ff}
    .progress{height:12px;border-radius:999px;background:rgba(255,255,255,0.06);margin-top:10px}
    .progress > i{height:100%;width:0;background:linear-gradient(90deg,#7c3aed,#60a5fa);display:block;transition:width .25s}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Roblox Group Member Viewer</h1>
      <p>Enter a Roblox Group ID to fetch all members, display names, usernames, and roles.</p>

      <label>Group ID</label>
      <input id="groupId" placeholder="e.g. 1234567">

      <button id="checkBtn">Check Members</button>
      <button id="exportBtn" class="secondary" disabled>Export CSV</button>

      <div class="progress"><i id="bar"></i></div>

      <table id="table" style="display:none">
        <thead>
          <tr>
            <th>Username</th>
            <th>Display Name</th>
            <th>Role</th>
            <th>UserID</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <p id="count" style="margin-top:10px;color:var(--muted)"></p>

      <footer style="margin-top:15px;color:var(--muted);font-size:13px">
        Uses Roblox public API via corsproxy.io.  
        Made by PaulusKernmagne ‚ù§
      </footer>
    </div>
  </div>

<script>
const proxy = "https://corsproxy.io/?";

const bar = document.getElementById("bar");
const table = document.getElementById("table");
const tbody = document.getElementById("tbody");
const count = document.getElementById("count");
const exportBtn = document.getElementById("exportBtn");

function progress(p){ bar.style.width = Math.max(0,Math.min(100,p))+"%"; }

async function fetchJSON(url) {
  const res = await fetch(proxy + url);
  if (!res.ok) throw new Error("API Error " + res.status);
  return res.json();
}

async function fetchGroupMembers(groupId) {
  let cursor = "";
  const all = [];
  
  while (true) {
    const url = `https://groups.roblox.com/v1/groups/${groupId}/users?limit=100` + 
      (cursor ? `&cursor=${cursor}` : "");

    const data = await fetchJSON(url);

    for (const m of data.data) {
      all.push({
        userId: m.user.userId,
        username: m.user.username,
        displayName: m.user.displayName,
        rank: m.role.rank,
        role: m.role.name
      });
    }
    
    progress((all.length % 100) * 1.5);

    if (!data.nextPageCursor) break;
    cursor = data.nextPageCursor;
    
    await new Promise(r => setTimeout(r, 250));
  }

  return all;
}

document.getElementById("checkBtn").onclick = async () => {
  const group = document.getElementById("groupId").value.trim();
  if (!group) return alert("Enter a group ID.");

  tbody.innerHTML = "";
  table.style.display = "none";
  count.textContent = "";
  exportBtn.disabled = true;
  progress(0);

  try {
    const members = await fetchGroupMembers(group);

    members.sort((a,b)=>b.rank - a.rank);

    members.forEach((m)=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${m.username}</td>
        <td>${m.displayName}</td>
        <td>${m.role}</td>
        <td>${m.userId}</td>
      `;
      tbody.appendChild(tr);
    });

    table.style.display = "";
    count.textContent = `${members.length} members found`;

    exportBtn.disabled = false;
    exportBtn.onclick = () => {
      const lines = [
        "username,displayName,role,userId"
      ];
      members.forEach((m)=>{
        lines.push(`"${m.username}","${m.displayName}","${m.role}",${m.userId}`);
      });
      const blob = new Blob([lines.join("\n")], {type:"text/csv"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `group_${group}_members.csv`;
      a.click();
      URL.revokeObjectURL(url);
    };

  } catch (err) {
    alert("Error: " + err.message);
  }

  progress(100);
};
</script>

</body>
</html>
